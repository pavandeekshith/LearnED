"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[852],{3852:(e,a,s)=>{s.r(a),s.d(a,{default:()=>r});var o=s(2555),t=s(5043),n=s(6767),l=s(759),i=s(579);const r=()=>{const[e,a]=(0,t.useState)({firstName:"",lastName:"",password:"",confirmPassword:"",phoneNumber:"",profilePictureUrl:"",bio:"",qualifications:"",experience_years:"",specializations:"",availability_timezone:""}),[s,r]=(0,t.useState)(""),[c,d]=(0,t.useState)(!1),[u,m]=(0,t.useState)(!0),[p,h]=(0,t.useState)(null),[g,b]=(0,t.useState)(""),[x,f]=(0,t.useState)(null),N=((0,n.zy)(),(0,n.Zp)());(0,t.useEffect)((()=>{console.log("\ud83d\udd0d TeacherOnboarding mounted"),console.log("\ud83d\udccd Current URL:",window.location.href),console.log("\ud83d\udd17 Hash:",window.location.hash);const e=async(e,s)=>{if(console.log("\ud83d\udd10 Auth event:",e),console.log("\ud83d\udc64 Session:",s),console.log("\u23f0 Auth loading state BEFORE:",u),"SIGNED_IN"===e&&null!==s&&void 0!==s&&s.user){const e=s.user;console.log("\u2705 User authenticated:",e),console.log("\ud83d\udce7 User email:",e.email),console.log("\ud83d\udcdd User metadata:",e.user_metadata),b(e.email),a((a=>(0,o.A)((0,o.A)({},a),{},{firstName:e.user_metadata.first_name||"",lastName:e.user_metadata.last_name||""})));try{console.log("\ud83d\udd0d Checking for invitation..."),console.log("\ud83d\udce7 Looking for email:",e.email),console.log("\ud83d\udcc5 Current time:",(new Date).toISOString());const{data:s,error:t}=await l.N.from("teacher_invitations").select("*").eq("email",e.email);if(t)return console.error("\u274c RLS ERROR - Cannot read teacher_invitations table:",t),r("Database access error. Please contact admin. Error: "+t.message),void m(!1);console.log("\ud83d\udccb All invitations for this email:",s);const{data:n,error:i}=await l.N.from("teacher_invitations").select("*").eq("email",e.email).eq("status","pending").gt("expires_at",(new Date).toISOString()).limit(1);console.log("\ud83d\udce8 Valid invitation query result:",n),console.log("\ud83d\udce8 Invitation query error (if any):",i),i?(console.error("\u274c Invitation query error:",i),r("Error checking invitation: "+i.message),m(!1)):n&&0!==n.length?(console.log("\u2705 Valid invitation found:",n[0]),f(n[0]),a((a=>(0,o.A)((0,o.A)({},a),{},{firstName:n[0].first_name||e.user_metadata.first_name||"",lastName:n[0].last_name||e.user_metadata.last_name||""}))),m(!1)):(console.warn("\u26a0\ufe0f No valid invitation found"),r("No valid invitation found for "+e.email+". Please check your email or contact admin."),m(!1))}catch(t){console.error("\ud83d\udca5 Unexpected error:",t),r("Unexpected error: "+t.message)}m(!1)}else"SIGNED_OUT"===e&&(console.log("\ud83d\udeaa User signed out"),m(!1))},{data:s}=l.N.auth.onAuthStateChange(e);return(async()=>{console.log("\ud83d\udd0d Checking existing session...");const{data:{session:a},error:s}=await l.N.auth.getSession();if(s)return console.error("\u274c Session error:",s),r("Authentication error: "+s.message),void m(!1);null!==a&&void 0!==a&&a.user?(console.log("\u2705 Existing session found"),await e("SIGNED_IN",a)):(console.log("\u26a0\ufe0f No existing session"),r("No authentication found. Please check your email and click the magic link again."),m(!1))})(),()=>{s&&s.subscription&&s.subscription.unsubscribe()}}),[N]);const y=e=>{const{name:s,value:t}=e.target;a((e=>(0,o.A)((0,o.A)({},e),{},{[s]:t})))};return(0,i.jsx)("div",{className:"min-h-screen bg-gray-100 flex flex-col justify-center items-center",children:(0,i.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-8 max-w-md w-full",children:[(0,i.jsx)("h2",{className:"text-2xl font-bold text-center text-gray-800 mb-6",children:"Complete Your Teacher Profile"}),u&&(0,i.jsxs)("div",{className:"text-center py-8",children:[(0,i.jsx)("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"}),(0,i.jsx)("p",{className:"mt-4 text-gray-600",children:"Verifying your authentication..."})]}),s&&(0,i.jsx)("p",{className:"text-red-500 text-center mb-4",children:s}),!u&&!x&&(0,i.jsx)("div",{className:"text-center py-4",children:(0,i.jsx)("p",{className:"text-gray-600",children:"Please check your email and click the magic link to continue."})}),!u&&x&&(0,i.jsxs)("form",{onSubmit:async a=>{if(a.preventDefault(),r(""),e.password&&""!==e.password.trim())if(e.password.length<8)r("Password must be at least 8 characters long.");else if(e.password===e.confirmPassword){if(e.phoneNumber&&""!==e.phoneNumber.trim()){const a=e.phoneNumber.replace(/\D/g,"");if(a.length<7||a.length>15)return void r("Please enter a valid phone number (7-15 digits).")}d(!0);try{console.log("\ud83d\udcdd Starting teacher onboarding submission..."),console.log("\ud83d\udd10 Updating password...");const{error:a}=await l.N.auth.updateUser({password:e.password});if(a)throw console.error("\u274c Password update error:",a),a;console.log("\u2705 Password updated successfully"),console.log("\ud83d\udcde Calling complete_teacher_onboarding RPC...");const{data:s,error:o}=await l.N.rpc("complete_teacher_onboarding",{p_first_name:e.firstName||null,p_last_name:e.lastName||null,p_phone:e.phoneNumber||null,p_profile_image_url:e.profilePictureUrl||null,p_bio:e.bio||null,p_qualifications:e.qualifications||null,p_experience_years:e.experience_years?parseInt(e.experience_years):null,p_specializations:e.specializations?e.specializations.split(",").map((e=>e.trim())).filter(Boolean):null,p_availability_timezone:e.availability_timezone||null});if(o)throw console.error("\u274c RPC error:",o),o;console.log("\u2705 Onboarding completed successfully:",s),d(!1),alert("Onboarding complete! You have been successfully registered as a teacher. You can now login using the mobile app."),await l.N.auth.signOut(),N("/")}catch(s){console.error("\ud83d\udca5 Onboarding error:",s),r(s.message||"An unexpected error occurred."),d(!1)}}else r("Passwords do not match. Please re-enter.");else r("Password is required.")},children:[(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"email",children:"Email"}),(0,i.jsx)("input",{type:"email",name:"email",id:"email",value:g,disabled:!0,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline bg-gray-200"})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"firstName",children:"First Name"}),(0,i.jsx)("input",{type:"text",name:"firstName",id:"firstName",value:e.firstName,onChange:y,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",required:!0})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"lastName",children:"Last Name"}),(0,i.jsx)("input",{type:"text",name:"lastName",id:"lastName",value:e.lastName,onChange:y,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",required:!0})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsxs)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"password",children:["Password (min 8 characters) ",(0,i.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,i.jsx)("input",{type:"password",name:"password",id:"password",value:e.password,onChange:y,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",required:!0})]}),(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsxs)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"confirmPassword",children:["Confirm Password ",(0,i.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,i.jsx)("input",{type:"password",name:"confirmPassword",id:"confirmPassword",value:e.confirmPassword,onChange:y,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline",required:!0})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsxs)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"phoneNumber",children:["Phone Number ",(0,i.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,i.jsx)("input",{type:"tel",name:"phoneNumber",id:"phoneNumber",value:e.phoneNumber,onChange:y,placeholder:"Enter your phone number",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",required:!0})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"profilePictureUrl",children:"Profile Picture URL"}),(0,i.jsx)("input",{type:"text",name:"profilePictureUrl",id:"profilePictureUrl",value:e.profilePictureUrl,onChange:y,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"})]}),(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"bio",children:"Bio / About Me"}),(0,i.jsx)("textarea",{name:"bio",id:"bio",value:e.bio,onChange:y,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",rows:"4"})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"qualifications",children:"Qualifications"}),(0,i.jsx)("input",{type:"text",name:"qualifications",id:"qualifications",value:e.qualifications,onChange:y,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"experience_years",children:"Years of Experience"}),(0,i.jsx)("input",{type:"number",name:"experience_years",id:"experience_years",value:e.experience_years,onChange:y,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"specializations",children:"Specializations (comma-separated)"}),(0,i.jsx)("input",{type:"text",name:"specializations",id:"specializations",value:e.specializations,onChange:y,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"})]}),(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"availability_timezone",children:"Timezone"}),(0,i.jsx)("input",{type:"text",name:"availability_timezone",id:"availability_timezone",value:e.availability_timezone,onChange:y,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"})]}),(0,i.jsx)("div",{className:"flex items-center justify-between",children:(0,i.jsx)("button",{type:"submit",disabled:c,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full disabled:bg-gray-400",children:c?"Submitting...":"Complete Registration"})})]})]})})}}}]);
//# sourceMappingURL=852.aa95fabf.chunk.js.map